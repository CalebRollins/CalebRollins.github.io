{"data":{"markdownRemark":{"html":"<p>When I was creating <a href=\"https://drive.google.com/drive/u/1/folders/0B3awpsZxDZ3mMWJ0OXZYM2tMcjQ\">Evol</a>, my evolutionary fractal generation program, I ran into a well known problem in Unity. When you child objects to a non-uniformly scaled parent (i.e., a parent whose x, y, and z scale values are different), rotating the children makes them skewed.</p>\n<p>Since fractals are by their nature hierarchical, this produced some strange results when I wanted to thicken the branches of my fractals. </p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a7984a377bd500ad67d8183a38703fda/03865/heartcake.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto; [object Object] max-width: 650px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 33.49007314524556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/svg+xml,%3csvg xmlns=\\'http://www.w3.org/2000/svg\\' width=\\'400\\' height=\\'134\\' viewBox=\\'0 0 400 134\\' version=\\'1\\'%3e%3cpath d=\\'M0 67v67h401V67l-1-57v11h-62v11h23c0 1-11 2-19 1h-7v5c0 6 1 7 14 6l11-1c0-2 2-2 3-2 7 3-15 7-26 4l-4-1v5c0 6 1 7 11 8 9 0 18-1 19-4 0-2 3-2 3 0 0 4-19 7-30 4-6-2-8-3-6-6 2-1 2-3 2-6l1-4 1-5c0-3 0-5 2-5l1-5v-4h-44l-48 1h-4V0h-53c-57 0-54 0-54 5l-2 3c-2 2-2 2-4 0l-2-5V1L63 0H0v67m328-7c-3 4 2 8 13 10 15 2 31-3 26-9-2-1-2-1-2 1 0 9-33 9-35 0 0-3-1-3-2-2m-2 9c-1 2-2 8-2 17v4-3l6 3c15 8 41 3 41-7 0-6-2-6-3-1-1 7-6 9-18 10-14 1-24-4-24-12l1-3c18 10 48 5 42-6-1-2-1-2-2 1-2 6-7 8-18 8-14 0-20-2-21-9 0-3-1-3-2-2\\' fill=\\'lightgray\\' fill-rule=\\'evenodd\\'/%3e%3c/svg%3e'); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"Heart and Cake\"\n        title=\"\"\n        src=\"/static/a7984a377bd500ad67d8183a38703fda/b42e8/heartcake.png\"\n        srcset=\"/static/a7984a377bd500ad67d8183a38703fda/46103/heartcake.png 163w,\n/static/a7984a377bd500ad67d8183a38703fda/1a1f2/heartcake.png 325w,\n/static/a7984a377bd500ad67d8183a38703fda/b42e8/heartcake.png 650w,\n/static/a7984a377bd500ad67d8183a38703fda/30634/heartcake.png 975w,\n/static/a7984a377bd500ad67d8183a38703fda/51518/heartcake.png 1300w,\n/static/a7984a377bd500ad67d8183a38703fda/03865/heartcake.png 1914w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n      />\n  </span>\n  </a></p>\n<p>While I was touched when Unity made me a heart and tiered wedding cake, this isn't what I wanted.</p>\n<div class=\"noMargin\">![Good fractal](wanted_this.png)</div>\n<div class=\"caption\">Wanted this</div>  \n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6b5091fbddc384e6e4035b379e80b0d7/c0141/got_this.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto; [object Object] max-width: 610px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 32.84169124877089%; position: relative; bottom: 0; left: 0; background-image: url('data:image/svg+xml,%3csvg xmlns=\\'http://www.w3.org/2000/svg\\' width=\\'400\\' height=\\'131\\' viewBox=\\'0 0 400 131\\' version=\\'1\\'%3e%3cpath d=\\'M0 66v65h401V0h-79a581 581 0 0 0-74 3c-2 1-1 2 1 2h2c1 1 0 1-1 1l-2 1h-1l-2-1v1l-2 2c-1 0-7-5-7-7s-8-2-120-2H0v66m342-39c-20 6-39 13-35 13l37-11c19-6 17-7-2-2M32 27l38 12a2285 2285 0 0 1 8-1c-19-6-46-12-46-11m340 5a684 684 0 0 0-37 11l2 1h-2c-2 1-2 1 0 1 5 0 44-12 46-14l-9 1M4 35l37 11 19 3-2-1 2-1h-2c-4 0-5 0-3-1s1-1-3-1l-15-4a558 558 0 0 0-33-6m214 18l-3 2c-1 0-2 0-3 2-2 1-3 2-4 1-2 0-2 0-1 2v6h-4c-3 2-3 2-6 0-4-1-5-5-3-6l1-2h-2c-2 1-2 1-4-1l-3-2-3-1c-5-3-7-2-4 1 2 2 4 3 5 2 3 0 7 3 7 7 0 2 0 2-6 2l-12-1-9-2 5 2 6 2 7 1c10-1 16 1 17 6s3 5 4 0c0-7 11-9 32-4 7 2 14 3 15 2v1c-1 1-1 1 1 1 2-1 8 0 15 1l14 2-23-5-29-5-4-1 11-3 14-3c2 0 2 0 1-1h-7c-9 3-22 6-27 6-6 0-6 0-6-2 0-3 3-6 7-7 3 0 6-2 6-4s-3-1-5 1m50 9c-1 1-2 2-6 1s-5 0-7 1c-2 2-1 4 2 4l3 2c2 3 6 2 8-2 1-2 2-4 4-4s3-2 1-2l-3-1-2 1m103 6a183 183 0 0 0 16 5l-6 1c-7 1-28 8-28 9l2 1a611 611 0 0 1 41-10c-1-1-1-1 1-1s3 0 3-2-1-2-2-2c-9 2-12 2-34-5l-5-1 12 5M84 95l-33 11c-5 3 10-1 32-8 19-6 19-8 1-3\\' fill=\\'lightgray\\' fill-rule=\\'evenodd\\'/%3e%3c/svg%3e'); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"Bad fractal\"\n        title=\"\"\n        src=\"/static/6b5091fbddc384e6e4035b379e80b0d7/cbcba/got_this.png\"\n        srcset=\"/static/6b5091fbddc384e6e4035b379e80b0d7/7b966/got_this.png 163w,\n/static/6b5091fbddc384e6e4035b379e80b0d7/81e6b/got_this.png 325w,\n/static/6b5091fbddc384e6e4035b379e80b0d7/cbcba/got_this.png 650w,\n/static/6b5091fbddc384e6e4035b379e80b0d7/2e506/got_this.png 975w,\n/static/6b5091fbddc384e6e4035b379e80b0d7/c0141/got_this.png 1017w\"\n        sizes=\"(max-width: 610px) 100vw, 610px\"\n      />\n  </span>\n  </a></p>\n<div class=\"caption\">Got this</div>  \n<p>There are a couple of ways to circumvent this problem, as per aldonaletto's answer <a href=\"http://answers.unity3d.com/questions/197739/object-skewing-on-rotation.html\">here</a>. One is to parent your rotated objects and your non-uniformly scaled object to an empty, uniformly scaled object. I didn't choose this approach because it was important to me that the object hierarchy remain unchanged.</p>\n<p>Another solution is to create the objects in their correct scale in an external 3D modeling program such as Blender. This way, you can leave the scale as 1,1,1 in Unity. I couldn't do it this way since my intention was to create several objects with different scales programmatically. </p>\n<p>My solution was to forgo Unity's built in scale system altogether and manually edit the mesh myself. While I can't guarantee this will work for any models more complex than the simple cylinders that comprise my fractals' branches, it worked well for me.</p>\n<pre><code>public static void Scale (MeshFilter originalMesh, float x, float y, float z)\n{\n  Vector3[] verts = originalMesh.mesh.vertices; // get all vertices from the mesh\n\n  for (int i = 0; i < verts.Length; i++)\n    verts[i] = Vector3.Scale(verts[i], new Vector3(x, y, z)); // scale the vertices\n    \n  originalMesh.mesh.vertices = verts; // reassign the vertices back to the mesh\n}</code></pre>\n<p>Then I just called it like this...</p>\n<p>...and voila!</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/da3aa5870a3506ae78fa5abfcd74380a/96fee/voila.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto; [object Object] max-width: 503px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 36.591179976162095%; position: relative; bottom: 0; left: 0; background-image: url('data:image/svg+xml,%3csvg xmlns=\\'http://www.w3.org/2000/svg\\' width=\\'400\\' height=\\'146\\' viewBox=\\'0 0 400 146\\' version=\\'1\\'%3e%3cpath d=\\'M0 73v73h401V0h-15c-14 0-16 0-15 2h1l2-1-1 2v4c1 6-4 10-7 6l-3-3-2-3-2-5-1-2H0v73M134 7l1 3 3 5 3 5 3 3c2 3 4 2 6 0v-8l1-2 1-2-2 1c0 1-1 1-1-1h-4c-2 2-3 2-7-2l-4-2m128 3c-3 2-2 4 1 8l12 16 9 12v27l-3-4c-2-4-3-4-10-7-11-4-10-3-22-18-10-14-13-16-17-13s-4 4 0 8l21 26-6-3-6-2-10 2c-11 2-14 4-13 7 1 4 3 4 20 1l17-3 15 5 15 6 9 12c10 13 10 10 10 30 0 10 0 10 2 10 5 0 5-2 5-15 0-12-1-13-3-13s-1-1 7-12c10-15 7-13 24-19l14-6 16 3c18 3 20 3 20-1s-3-6-14-7c-10-2-11-2-14-1l-3 2c-1-1 15-22 17-23 4-1 4-3 1-6-3-4-8-4-9 0 0 2-4 8-9 15l-8 12h-2c-1-2-2-1-11 2l-9 4V55l-1-9c-3 0-3 0 5-12a363 363 0 0 0 13-16c3-1 4-4 1-7s-11-2-9 2l-6 10-7 11-2-2c-4-8-14-22-17-23-3 0-7 2-7 4 1 1-1 5-5 11l-7 12c-1 1-1 1-1-1 0-3-9-17-15-23-2-3-5-4-8-2M62 19l8 11 8 12 1 12v13l-2-1-12-5-10-4-8-11c-6-9-10-13-10-10l8 11 8 11h-3c-5 0-22 4-22 5-2 2 2 1 15-1l12-3 12 5 12 4 7 10 7 10v12l1 12 1-12V87l6-8c7-10 7-11 6-11l-7 8-6 9-7-9-7-10V42l7-11 7-10 7 10 7 11v26l12-5 12-5 13 3 14 1c1-1-2-2-13-4l-12-2 8-10c7-10 8-12 6-12l-8 11-8 11-11 4-11 5V41l8-11 7-12-2 1-7 10-7 10-3-3-7-11c-4-6-7-9-7-6L79 39l-8-10c-6-9-9-13-9-10m241 1l-8 14c-8 11-8 12-5 12 2 1 2 2 2 14l1 13 11 16 2 3 5-8c4-6 6-8 8-8h2V44l-8-12c-10-14-10-14-10-12m96 58l-6 1h-7l-4 2c-2 1-1 2 3 5l6 4c1 2 2 2 2 1l4-1c2 0 3-2 3-9l-1-3M176 88h-6c-5 0-12 2-11 4l4 4 6 4c1 2 2 2 2 1l3-1c2 0 3-1 4-3l2-4 2-1 2-1c2-1 2-1 1-3h-9\\' fill=\\'lightgray\\' fill-rule=\\'evenodd\\'/%3e%3c/svg%3e'); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"Before and after fractal\"\n        title=\"\"\n        src=\"/static/da3aa5870a3506ae78fa5abfcd74380a/a7c28/voila.png\"\n        srcset=\"/static/da3aa5870a3506ae78fa5abfcd74380a/2791f/voila.png 163w,\n/static/da3aa5870a3506ae78fa5abfcd74380a/43328/voila.png 325w,\n/static/da3aa5870a3506ae78fa5abfcd74380a/a7c28/voila.png 650w,\n/static/da3aa5870a3506ae78fa5abfcd74380a/96fee/voila.png 839w\"\n        sizes=\"(max-width: 503px) 100vw, 503px\"\n      />\n  </span>\n  </a></p>","frontmatter":{"date":"September 26, 2016","path":"/blog/2016-09-26","title":"Rotating Children of a Non-Uniformly Scaled Parent without Deformation in Unity"}}},"pageContext":{}}